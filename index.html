<!DOCTYPE html>
<script>
    // 1. BASİT GİRİŞ ŞİFRESİ
    const sifre = "kamera2025"; // Burayı kendi şifrenle değiştir
    let girilen = prompt("Lütfen giriş şifresini yazın:");

    if (girilen !== sifre) {
        alert("Hatalı şifre!");
        document.body.innerHTML = "<h1>Erişim Reddedildi.</h1>";
        window.stop(); // Sayfanın geri kalanını yüklemeyi durdurur
    }

    // ... Supabase bağlantı kodların burada kalacak ...

    // 2. LİNK MASKELEME FONKSİYONU
    // Bu fonksiyon, linkin çalınmasını zorlaştırır.
    function yayiniAc(id) {
        // Kullanıcı linki sağ tıklayıp kopyalayamaz, çünkü link DOM'da doğrudan yok.
        // Veriyi o an Supabase'den veya hafızadaki listeden bulup açarız.
        const kamera = kameralarListesi.find(k => k.id === id);
        if (kamera && kamera.stream_url) {
            window.open(kamera.stream_url, '_blank');
        }
    }
</script>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TR Canlı Kameralar - Koyu Harita</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: sans-serif; margin: 0; background: #121212; color: white; }
        #map { height: 100vh; width: 100%; } /* Tam ekran koyu harita */
        .leaflet-popup-content { color: #000; }
    </style>
</head>
<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // BURAYI SUPABASE'DEN ALDIĞIN BİLGİLERLE DOLDUR
        const SUPABASE_URL = 'https://egrvojzmrykairbglqjq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVncnZvanptcnlrYWlyYmdscWpxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3MDgyNDcsImV4cCI6MjA4NDI4NDI0N30.sbIKNJcVlEGlVOgb_gBagP-Nn1NtBMKOlRzJmhH5TSM';

        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

        // KOYU TEMA HARİTA BAŞLATMA
        var map = L.map('map').setView([39.0, 35.0], 6);

        // CartoDB Dark Matter (Koyu Tema)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO'
        }).addTo(map);

        async function verileriYukle() {
            try {
                // Tablo isminiz 'Kameralar' (K harfi büyük) ise tam böyle yazın
                const { data, error } = await supabaseClient.from('Kameralar').select('*');
                
                if (error) {
                    console.error("Supabase Hatası:", error.message);
                    return;
                }

                if (data && data.length > 0) {
                    data.forEach(kamera => {
                        // Sütun isimlerini tablodaki gibi tam eşleşecek şekilde güncelledik
                        const ad = kamera['kamera adı'];
                        const lat = kamera['Enlem - koordinat için'];
                        const lng = kamera['Boylam - koordinat için'];
                        const img = kamera['snapshot_url'];
                        const stream = kamera['stream_url'];

                        if (lat && lng) {
                            L.marker([lat, lng]).addTo(map)
                                .bindPopup(`
                                    <div style="text-align:center">
                                        <b>${ad || 'Kamera'}</b><br>
                                        <img src="${img || 'https://via.placeholder.com/150'}" width="150" style="margin:5px 0"><br>
                                        <a href="${stream}" target="_blank">Canlı İzle</a>
                                    </div>
                                `);
                        }
                    });
                }
            } catch (err) {
                console.error("Hata:", err);
            }
        }

        verileriYukle();
    </script>
</body>
</html>
